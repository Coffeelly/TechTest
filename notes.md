# Refactoring Notes

I refactored the initial one file script into multiple files that are independent and perform distinct functionalities based on Object Oriented Programming and Separation of Concerns. I implemented an abstract `BaseDocumentStore` interface. I created two implementations which are `QdrantDocumentStore` and `MemoryDocumentStore`. This allows the system to switch backends dynamically without modifying the business logic. I created `Controller` class to manage business logic. This keeps the FastAPI router in `main.py` clean and only acts as an interface layer, while the core logic does not depend on FastAPI. The embedding and RAG workflow are separated into `EmbeddingService` and `RagWorkFlow` classes, ensuring that each class has a single responsibility. I also created `schemas.py` file to define Pydantic models which are `DocumentRequest` and `QuestionRequest`. This separates data validation rules from business logic. I extracted the database configuration (URL) into `environment variables`, making the application cloud-native and ready for different deployment environments.

for the trade-off I considered between keeping simple `if-else` statements for storage management versus implementing a full polymorphic structure. In the end I chose to create an abstract `BaseDocumentStore` with `QdrantDocumentStore` and `MemoryDocumentStore` implementations. increased the number of files and code compared to simple conditionals, but it was necessary to eliminate all the storage checks scattered throughout the application. This allow new storage backends to be added without modifying existing logic.

It is easier to test the logic in the refactored code without needing the real database server running because I removed the global variables. We can use fake data just to check if the code works. Each part of the code is independent. For example, the API doesn't know how the database logic works. So if we want to change Qdrant to another database, we only need to change the document.py file and the API code will still work. The same goes with embedding.py if we want to change embedding model or rag.py if we want to change the rag logic while the other files do not need any changes.
